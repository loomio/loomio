- item = NotificationItem.new(notification).item
- begin
  - actor = item.actor
  - action_text = item.action_text
  - title_text = item.title
  - group_name = item.group_full_name
  - href = item.link
  - avatar = item.avatar

  - date = time_ago_in_words(notification.created_at)
  - class_name = notification.viewed_at.nil? ? " unread" : ""

  %li.selector-item{:class => "notification-item#{class_name}", :id => "notification-#{notification.id}" }
    %a{:href => href }
      = render 'avatar', user: avatar

      %span.notification-content
        - subject = actor ? actor.name : ''
        - verb = action_text
        - object = title_text ? truncate(title_text, :length => 80, :omission => '...') : ''

        - t(:subject_verb_object).split(' ').each do |chunk|
          - case chunk
          - when '%s'
            %span.bold-name= subject
          - when '%v'
            = verb
          - when '%o'
            %span.bold-name= object

        %span.notification-item-footer
          = "#{t(:ago, :quantity_of_time => date)} Â· #{group_name}"

- rescue Exception => e
  - stuff = "\n #{notification.inspect}\n #{item.inspect}\n #{notification.event.inspect}\n #{e}\n #{e.backtrace.join("\n ")}"
  - logger.error "NOTIFICATION ERROR:" + stuff




