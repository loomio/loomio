<script lang="coffee">
import { differenceInHours } from 'date-fns'
import { exact, approximate } from '@/shared/helpers/format_time'

export default
  props:
    poll: Object
    approximate: Boolean

  methods:
    exact: exact
    timeMethod: ->
      if @approximate
        approximate(@time)
      else
        exact(@time)

  computed:
    time: ->
      key = if @poll.isActive() then 'closingAt' else 'closedAt'
      @poll[key]

    translationKey: ->
      if @poll.isActive()
        'common.closing_in'
      else
        'common.closed_ago'

    color: ->
      if @poll.isActive()
        if differenceInHours(new Date, @poll.closingAt) < 24
          'warning'
        else
          'primary'
      else
        'error'

</script>

<template lang="pug">
span(:style="'color: var(--v-'+color+'-base)'")
  v-icon(:color="color" x-small) mdi-timer-sand
  abbr.closing-in.timeago--inline(v-if="poll.closingAt")
    span(v-t="{ path: translationKey, args: { time: timeMethod(time) } }" :title="exact(time)")
  span(v-else v-t="'poll_common_wip_field.title'")
</template>
