%H1 AAARRR

%ul
  %li Awareness - homepage visits to www.loomio.org during cohort period
  %li Acquisition - number of organisations created during the cohort period
  %li Activation - number of organisations which had at least 5 sessions
  %li Retention - number of organisations which had at least 20 new sessions between their 20th and 40th day.
  %li Revenue - number of organisations from this cohort that decided to pay
  / %li Referral - number of organisations started by users who are part of a group in this cohort?

%p FYI: "Awareness" measurement started part way through cohort 4

%table.table
  %thead
    %tr
      %th Cohort
      %th Start on
      %th age range (days)
      %th Awareness
      %th Acquisition
      %th Activation
      %th Retention
      %th Revenue
      / %th Referral

  / manual hack to use until we have hooked up cohort.paying_organisations.count
  - revenue = ["0", "7: $46/mo", "6: $100/mo", "0: $0/mo", "2: $12/mo", "3: $20/mo", "5: $53/mo", "3: $43/mo", "2: $22/mo", "0: 0/mo", "1: $27/mo"]
  %tbody
    - @cohorts.each do |cohort|

      %tr
        %td= link_to cohort.id, admin_cohort_path(cohort) # cohort id
        %td= cohort.start_on
        %td #{( Date.today  - cohort.end_on ).to_i} - #{( Date.today  - cohort.start_on ).to_i }
        %td= visits_count = cohort.homepage_visits.count # homepage visits
        %td
          = org_count = cohort.organisations.count # acquisitions
          (#{safe_pct(org_count, visits_count)}%)
        %td
          = activated_count = cohort.activated_organisations.count
          (#{safe_pct(activated_count, org_count)}%)
        %td
          = retained_count = cohort.retained_organisations.count
          (#{safe_pct(retained_count, activated_count)}%)
        %td
          = revenue[cohort.id]
          -# cohort.paying_organisations.count
          / %td
          -# cohort.referral.count
