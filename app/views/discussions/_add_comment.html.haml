- if can? :add_comment, discussion
  = form_tag add_comment_discussion_path(discussion), :remote => true, id: "new-comment-form" do
    = render 'avatar', user: current_user, size: "medium", kind: nil, id: nil
    #comment-form-container
      #comment-input{ data: {group: @group.id} }
        = text_area_tag 'comment', "", class: 'js-warn-before-navigating-away', id: 'wmd-input-comment', placeholder: t(:comment_form_placeholder)
      #wmd-button-bar-comment.wmd-button-bar.hide
      #attachment-container
      #comment-toolbar
        = submit_tag t(:comment_form_submit_button), class: "btn btn-success submit", id: 'post-new-comment', :data => {:disable_with => t(:comment_form_submit_button)}
        %a.btn{id: 'preview-comment'}= "Preview"
        .pull-right
          -unless browser.ie? && browser.version.to_i < 10
            %a.btn#add-attachment-icon{'data-title' => 'Attach a file'}
              .attachment-icon
          %a.btn#comment-formatting{'data-title' => 'Show formatting options'}
            %i.icon-font
      #wmd-preview-comment.hide.markdown

-unless browser.ie? && browser.version.to_i < 10
  = s3_uploader_form post: attachments_url, as: "attachment[location]", redirect_url: iframe_upload_result_attachments_url do
    = file_field_tag :file, multiple: true

  %script#template-upload-in-progress{type: "text/x-tmpl"}
    .attachment-uploader
      .uploading-filename
        {%=o.name%}
      %button.close.cancel-upload &times;
      .progress.active
        .bar

  %script#template-upload--attached{type: "text/x-tmpl"}
    .attachments
      .attachment-success{data: { 'attachment-id' => "{%=o.id%}" } }
        = link_to "{%=o.name%}", "{%=o.location%}", target: "_blank"
        ({%= (parseInt(o.size) / (1024*1024)).toFixed(2) + " MB" %})
        %button.close.remove-attachment &times;

  %script#template-upload--comment-input{type: "text/x-tmpl"}
    %input{type: 'hidden', name: "attachments[]", value: '{%=o.id%}', data: { 'attachment-id' => "{%=o.id%}" }}
